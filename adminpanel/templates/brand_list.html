{% extends "admin_base.html" %}
{% load static %}

{% block title %}Brand Management{% endblock %}

{% block extra_css %}
<style>
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideIn {
        from { transform: translateX(-100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    .animate-fade-in { animation: fadeIn 0.5s ease-out; }
    .animate-slide-in { animation: slideIn 0.3s ease-out; }
    .table-row:hover { background-color: #F9FAFB; transition: .2s; transform: translateY(-1px); }
</style>
{% endblock %}

{% block content %}
<div class="flex-1 p-6 md:p-8 overflow-y-auto">

    <!-- Header -->
    <div class="mb-8 animate-fade-in">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Brand Management</h1>
                <p class="text-gray-600 mt-2">Manage all product brands</p>
            </div>

            <button onclick="openAddModal()"
   class="px-5 py-3 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">
    + Add Brand
</button>

        </div>
    </div>

    <!-- Search -->
    <form method="GET" class="flex gap-2 mb-6">
        <input type="text" name="search" value="{{ search_query }}" placeholder="Search brands..."
               class="px-4 py-2 border rounded-lg">
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Search</button>
        <a href="{% url 'brand_list' %}" class="px-4 py-2 bg-gray-300 rounded-lg">Clear</a>
    </form>

    <!-- Stats -->
    <div class="grid grid-cols-1 md:grid-cols-1 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-md p-6 animate-fade-in">
            <p class="text-sm text-gray-500">Total Brands</p>
            <h3 class="text-2xl font-bold text-gray-800">{{ total_brands }}</h3>
        </div>
    </div>

    <!-- Table -->
    <div class="bg-white rounded-xl shadow-md overflow-hidden animate-fade-in">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-800">All Brands</h2>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="bg-gray-50 text-gray-600 text-sm font-medium">
                        <th class="py-4 px-6 text-left">Brand Name</th>
                        <th class="py-4 px-6 text-left">Description</th>
                        <th class="py-4 px-6 text-left">Status</th>
                        <th class="py-4 px-6 text-center">Action</th>
                    </tr>
                </thead>

                <tbody class="divide-y divide-gray-200">
                {% for brand in brands %}
                <tr class="table-row">
                    <td class="py-4 px-6 font-medium">{{ brand.name }}</td>
                    <td class="py-4 px-6 text-gray-600">{{ brand.description|default:"-" }}</td>
                    <td class="py-4 px-6">
    {% if brand.is_active %}
        <span class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-700">Active</span>
    {% else %}
        <span class="px-3 py-1 text-xs rounded-full bg-red-100 text-red-700">Inactive</span>
    {% endif %}
</td>


                    <td class="py-4 px-6 text-center">
         <!-- inside the table row -->
<button
  onclick="openEditModal({{ brand.id }}, '{{ brand.name|escapejs }}', '{{ brand.description|escapejs }}', '{{ brand.is_active }}')"
  class="px-4 py-2 bg-yellow-100 hover:bg-yellow-200 text-yellow-700 rounded-lg">
  Edit
</button>





                        <button onclick="openConfirmModal('{{ brand.id }}')" 
                                class="px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg ml-2">
                            Delete
                        </button>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="px-6 py-4 flex justify-between">
            <div class="text-sm text-gray-600">
                Showing {{ page_obj.start_index }} to {{ page_obj.end_index }} of {{ page_obj.paginator.count }} entries
            </div>

            <div class="flex space-x-2">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"
                   class="px-3 py-1 bg-gray-200 rounded-lg">Previous</a>
                {% endif %}

                <span class="px-3 py-1 bg-blue-600 text-white rounded-lg">{{ page_obj.number }}</span>

                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"
                   class="px-3 py-1 bg-gray-200 rounded-lg">Next</a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<!-- ADD BRAND MODAL -->
<div id="addBrandModal" class="fixed inset-0 z-50 hidden">
    <div class="modal-overlay absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg animate-slide-in p-6">

            <h3 class="text-xl font-semibold text-gray-800 mb-4">Add New Brand</h3>

            <form method="POST" action="{% url 'brand_add' %}">

                {% csrf_token %}

                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">Brand Name</label>
                    <input type="text" name="name" value="{{ name }}"
                           class="w-full px-4 py-2 border rounded-lg">
                    {% if errors.name %}
                        <p class="text-red-600 text-sm mt-1">{{ errors.name }}</p>
                    {% endif %}
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">Description</label>
                    <textarea name="description" class="w-full px-4 py-2 border rounded-lg" rows="4">{{ description }}</textarea>
                    {% if errors.description %}
                        <p class="text-red-600 text-sm mt-1">{{ errors.description }}</p>
                    {% endif %}
                </div>
                <div class="mb-4 flex items-center gap-3">
    <label class="text-gray-700 font-medium">Active</label>
    <label class="relative inline-flex cursor-pointer items-center">
        <input type="checkbox" name="is_active" class="sr-only peer"
               {% if is_active %}checked{% endif %}>
        <div class="w-11 h-6 bg-gray-300 peer-focus:ring-2 rounded-full peer
                    peer-checked:bg-blue-600
                    after:content-[''] after:absolute after:top-[2px] after:left-[2px]
                    after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all
                    peer-checked:after:translate-x-full"></div>
    </label>
</div>


                <div class="flex gap-3 justify-end">
                    <button type="button"
                            onclick="closeAddModal()"
                            class="px-6 py-2 border rounded-lg">
                        Cancel
                    </button>
                    <button type="submit"
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg">
                        Add Brand
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>


<!-- EDIT BRAND MODAL -->
<div id="editBrandModal" class="fixed inset-0 z-50 hidden">
  <div class="modal-overlay absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg animate-slide-in p-6">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">Edit Brand</h3>

      <form method="POST" id="editBrandForm"
            action="{% if open_edit_modal %}{% url 'brand_edit' edit_data.id %}{% else %}#{% endif %}">
        {% csrf_token %}
        <input type="hidden" id="editBrandIdInput" name="id" value="{% if edit_data %}{{ edit_data.id }}{% endif %}">

        <div class="mb-4">
          <label class="block text-gray-700 font-medium mb-2">Brand Name</label>
          <input type="text" id="editNameInput" name="name" value="{{ edit_data.name }}"
                 class="w-full px-4 py-2 border rounded-lg">
          {% if errors_edit.name %}
            <p class="text-red-600 text-sm mt-1">{{ errors_edit.name }}</p>
          {% endif %}
        </div>

        <div class="mb-4">
          <label class="block text-gray-700 font-medium mb-2">Description</label>
          <textarea id="editDescriptionInput" name="description"
                    class="w-full px-4 py-2 border rounded-lg" rows="4">{{ edit_data.description }}</textarea>
          {% if errors_edit.description %}
            <p class="text-red-600 text-sm mt-1">{{ errors_edit.description }}</p>
          {% endif %}
        </div>
        

<div class="mb-4 flex items-center gap-3">
    <label class="text-gray-700 font-medium">Active</label>
    <label class="relative inline-flex cursor-pointer items-center">
        <input type="checkbox" id="editActiveInput" name="is_active" class="sr-only peer"
               {% if edit_data.is_active %}checked{% endif %}>
        <div class="w-11 h-6 bg-gray-300 peer-focus:ring-2 rounded-full peer
                    peer-checked:bg-blue-600
                    after:content-[''] after:absolute after:top-[2px] after:left-[2px]
                    after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all
                    peer-checked:after:translate-x-full"></div>
    </label>
</div>

        <div class="flex gap-3 justify-end">
          <button type="button" onclick="closeEditModal()" class="px-6 py-2 border rounded-lg">Cancel</button>
          <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg">Update Brand</button>
        </div>
      </form>

    </div>
  </div>
</div>


<!-- Delete Modal -->
<div id="confirmModal" class="fixed inset-0 z-50 hidden">
    <div class="modal-overlay absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md animate-slide-in p-6 text-center">
            <h3 class="text-xl font-semibold text-gray-800 mb-3">Delete Brand?</h3>
            <p class="text-gray-600 mb-6">Are you sure you want to delete this brand?</p>

            <form method="POST" id="confirmForm">
                {% csrf_token %}
                <div class="flex justify-center gap-3">
                    <button type="button" onclick="closeConfirmModal()" class="px-6 py-2 border rounded-lg">
                        Cancel
                    </button>
                    <button type="submit" class="px-6 py-2 bg-red-600 text-white rounded-lg">
                        Delete
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function openConfirmModal(id) {
    const modal = document.getElementById("confirmModal");
    modal.classList.remove("hidden");
    document.getElementById("confirmForm").action = `/admin-panel/brand-delete/${id}/`;
}
function closeConfirmModal() {
    document.getElementById("confirmModal").classList.add("hidden");
}

function openAddModal() {
    document.getElementById("addBrandModal").classList.remove("hidden");
}

function closeAddModal() {
    document.getElementById("addBrandModal").classList.add("hidden");
}

{% if open_create_modal %}
    openAddModal();
{% endif %}

function openEditModal(id, name, description, active) {
    document.getElementById("editBrandModal").classList.remove("hidden");

    document.getElementById("editNameInput").value = name || "";
    document.getElementById("editDescriptionInput").value = description || "";

    const idInput = document.getElementById("editBrandIdInput");
    if (idInput) idInput.value = id;

      const activeInput = document.getElementById("editActiveInput");
    activeInput.checked = active === "True" || active === true;

    // FIXED URL
    const form = document.getElementById("editBrandForm");
    if (form) {
        form.action = `/admin-panel/brand-edit/${id}/`;
    }
}

function closeEditModal() {
    document.getElementById("editBrandModal").classList.add("hidden");
}

{% if open_edit_modal %}
openEditModal({{ edit_data.id }}, '{{ edit_data.name|escapejs }}', '{{ edit_data.description|escapejs }}', '{{ edit_data.is_active }}');
{% endif %}
</script>

{% endblock %}
