{% extends "admin_base.html" %}
{% block title %}Edit Coupon{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto mt-8 p-6 bg-white rounded-lg shadow-md">
    <h3 class="text-2xl font-bold text-gray-900 mb-6">Edit Coupon</h3>

    <form method="POST" class="space-y-6">
        {% csrf_token %}

        <!-- Coupon Code -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Coupon Code</label>
            <input type="text" name="code" required
                   value="{{ coupon.code }}"
                   class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500">
            <small class="text-red-600">{{ errors.code }}</small>
        </div>

        <!-- Discount Type -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Discount Type</label>
            <select name="discount_type" id="discountType"
                    class="w-full px-3 py-2 border rounded-md">
                <option value="flat"
                    {% if coupon.discount_type == "flat" %}selected{% endif %}>
                    Flat Amount (₹)
                </option>
                <option value="percent"
                    {% if coupon.discount_type == "percent" %}selected{% endif %}>
                    Percentage (%)
                </option>
            </select>
        </div>

        <!-- Discount Value -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Discount Value
            </label>
            <input type="number" step="0.01" name="discount_value" required
                   value="{{ coupon.discount_value }}"
                   class="w-full px-3 py-2 border rounded-md">
            <small class="text-red-600">{{ errors.discount_value }}</small>
        </div>

        <!-- Max Discount (only for percent) -->
        <div id="maxDiscountDiv" class="{% if coupon.discount_type != 'percent' %}hidden{% endif %}">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Max Discount Amount (₹)
            </label>
            <input type="number" step="0.01" name="max_discount_amount"
                   value="{{ coupon.max_discount_amount }}"
                   class="w-full px-3 py-2 border rounded-md">
            <small class="text-red-600">{{ errors.max_discount_amount }}</small>
        </div>

        <!-- Min Order -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Minimum Order Amount (₹)
            </label>
            <input type="number" step="0.01" name="min_order_amount" required
                   value="{{ coupon.min_order_amount }}"
                   class="w-full px-3 py-2 border rounded-md">
            <small class="text-red-600">{{ errors.min_order_amount }}</small>
        </div>

        <!-- Validity -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Valid From</label>
            <input type="datetime-local" name="valid_from"
                   value="{{ coupon.valid_from|date:'Y-m-d\\TH:i' }}"
                   class="w-full px-3 py-2 border rounded-md">
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Valid To</label>
            <input type="datetime-local" name="valid_to"
                   value="{{ coupon.valid_to|date:'Y-m-d\\TH:i' }}"
                   class="w-full px-3 py-2 border rounded-md">
            <small class="text-red-600">{{ errors.date }}</small>
        </div>

        <!-- Usage -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Usage Limit</label>
            <input type="number" name="usage_limit" required
                   value="{{ coupon.usage_limit }}"
                   class="w-full px-3 py-2 border rounded-md">
        </div>

        <!-- Active -->
        <div class="flex items-center">
            <input type="checkbox" name="is_active"
                   {% if coupon.is_active %}checked{% endif %}
                   class="h-4 w-4 text-blue-600 border-gray-300 rounded">
            <label class="ml-2 text-sm text-gray-900">Active</label>
        </div>

        <!-- Actions -->
        <div class="flex gap-3 pt-4">
            <button type="submit"
                    class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                Update Coupon
            </button>
            <a href="{% url 'coupon_list' %}"
               class="px-6 py-2 bg-gray-300 rounded-md">
                Back
            </a>
        </div>
    </form>
</div>

<!-- JS for conditional field -->
<script>
    const discountType = document.getElementById("discountType");
    const maxDiv = document.getElementById("maxDiscountDiv");

    function toggleMaxDiscount() {
        maxDiv.classList.toggle("hidden", discountType.value !== "percent");
    }

    discountType.addEventListener("change", toggleMaxDiscount);
    toggleMaxDiscount();
</script>
{% endblock %}
