{% extends "admin_base.html" %}
{% block title %}Add Coupon{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto mt-8 p-6 bg-white rounded-lg shadow-md">
    <h3 class="text-2xl font-bold text-gray-900 mb-6">Add Coupon</h3>

    <form method="POST" class="space-y-6">
        {% csrf_token %}

        <!-- Coupon Code -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Coupon Code</label>
            <input type="text" name="code" required
                   class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500">
            <small class="text-red-600">{{ errors.code }}</small>
        </div>

        <!-- Discount Type -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Discount Type</label>
            <select name="discount_type" id="discountType"
                    class="w-full px-3 py-2 border rounded-md">
                <option value="flat">Flat Amount (₹)</option>
                <option value="percent">Percentage (%)</option>
            </select>
        </div>

        <!-- Discount Value -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Discount Value
            </label>
            <input type="number" step="0.01" name="discount_value" required
                   class="w-full px-3 py-2 border rounded-md">
            <small class="text-red-600">{{ errors.discount_value }}</small>
        </div>

        <!-- Max Discount (only for percent) -->
        <div id="maxDiscountDiv" class="hidden">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Max Discount Amount (₹)
            </label>
            <input type="number" step="0.01" name="max_discount_amount"
                   class="w-full px-3 py-2 border rounded-md">
            <small class="text-red-600">{{ errors.max_discount_amount }}</small>
        </div>

        <!-- Min Order -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Minimum Order Amount (₹)
            </label>
            <input type="number" step="0.01" name="min_order_amount" required
                   class="w-full px-3 py-2 border rounded-md">
            <small class="text-red-600">{{ errors.min_order_amount }}</small>
        </div>

        <!-- Validity -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Valid From</label>
            <input type="datetime-local" name="valid_from"
                   class="w-full px-3 py-2 border rounded-md">
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Valid To</label>
            <input type="datetime-local" name="valid_to"
                   class="w-full px-3 py-2 border rounded-md">
            <small class="text-red-600">{{ errors.date }}</small>
        </div>

        <!-- Usage -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Usage Limit</label>
            <input type="number" name="usage_limit" required
                   class="w-full px-3 py-2 border rounded-md">
        </div>

        <!-- Per User Usage Limit -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Max Uses Per User
            </label>
            <input type="number" name="max_uses_per_user" value="1" min="1" required
                class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500">
            <small class="text-gray-500">
                How many times a single user can use this coupon
            </small>
        </div>


        <!-- Active -->
        <div class="flex items-center">
            <input type="checkbox" name="is_active" checked
                   class="h-4 w-4 text-blue-600 border-gray-300 rounded">
            <label class="ml-2 text-sm text-gray-900">Active</label>
        </div>

        <!-- Actions -->
        <div class="flex gap-3 pt-4">
            <button type="submit"
                    class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                Create Coupon
            </button>
            <a href="{% url 'coupon_list' %}"
               class="px-6 py-2 bg-gray-300 rounded-md">
                Back
            </a>
        </div>
    </form>
</div>

<!-- JS for conditional field -->
<script>
    const discountType = document.getElementById("discountType");
    const maxDiv = document.getElementById("maxDiscountDiv");

    function toggleMaxDiscount() {
        maxDiv.classList.toggle("hidden", discountType.value !== "percent");
    }

    discountType.addEventListener("change", toggleMaxDiscount);
    toggleMaxDiscount();
</script>
{% endblock %}
